---
import { optimizeGooglePlayImage } from "../utils/image-optimization";
import { getLangFromUrl, useTranslations } from "../i18n/utils";

interface Props {
  title: string;
  description: string;
  heroImage?: string;
  realIconUrl?: string;
  tags?: string[];
  pubDate: Date;
  slug: string;
}

const {
  title,
  description,
  heroImage,
  realIconUrl,
  tags = [],
  pubDate,
  slug,
} = Astro.props;

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);
const href = lang === 'es' ? `/es/apps/${slug}` : `/apps/${slug}`;
---

<a
  href={href}
  data-astro-prefetch
  class="group relative flex flex-col h-full bg-surface dark:bg-[#1e1e1e] rounded-3xl overflow-hidden shadow-sm hover:shadow-2xl hover:scale-[1.02] motion-reduce:transform-none transition-all duration-300 border border-gray-100 dark:border-gray-800 focus-visible:ring-2 focus-visible:ring-primary focus-visible:outline-none transform-gpu"
>
  <!-- Image Area -->
  <div class="relative h-56 overflow-hidden bg-gray-100 dark:bg-gray-800">
    {
      heroImage ? (
        <img
          src={optimizeGooglePlayImage(heroImage, 800, "width")}
          alt={title}
          width="400"
          height="224"
          loading="lazy"
          decoding="async"
          class="w-full h-full object-cover transform group-hover:scale-110 group-focus-visible:scale-110 motion-reduce:transform-none transition-transform duration-700"
        />
      ) : (
        <div
          class="w-full h-full flex items-center justify-center text-gray-300 dark:text-gray-700"
          aria-hidden="true"
        >
          <span class="material-icons text-6xl">smartphone</span>
        </div>
      )
    }
    <div
      class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-60 group-hover:opacity-40 transition-opacity"
      aria-hidden="true"
    >
    </div>

    {
      realIconUrl && (
        <div class="absolute top-4 right-4 w-16 h-16 rounded-xl overflow-hidden shadow-lg border-2 border-white/20 backdrop-blur-sm z-10">
          <img
            src={optimizeGooglePlayImage(realIconUrl, 128, "square")}
            alt={`${t('apps.icon_alt')} ${title}`}
            loading="lazy"
            decoding="async"
            width="64"
            height="64"
            class="w-full h-full object-cover"
          />
        </div>
      )
    }

    <!-- Tags Overlay -->
    <div class="absolute bottom-4 left-4 flex flex-wrap gap-2">
      {
        tags
          .slice(0, 2)
          .map((tag) => (
            <span class="px-3 py-1 text-xs font-bold bg-white/20 backdrop-blur-md text-white rounded-full border border-white/30">
              {tag}
            </span>
          ))
      }
    </div>
  </div>

  <!-- Content Area -->
  <div class="p-8 flex flex-col flex-grow relative">
    <!-- Decorative glow -->
    <div
      class="absolute top-0 right-0 w-24 h-24 bg-primary/10 rounded-bl-full -mr-4 -mt-4 opacity-0 group-hover:opacity-100 transition-opacity duration-500"
      aria-hidden="true"
    >
    </div>

    <h2
      class="text-2xl font-bold mb-3 text-on-surface dark:text-gray-100 group-hover:text-primary group-focus-visible:text-primary transition-colors"
    >
      {title}
    </h2>
    <p
      class="text-on-surface-variant dark:text-gray-300 mb-6 line-clamp-3 leading-relaxed flex-grow"
    >
      {description}
    </p>

    <div
      class="flex items-center justify-between mt-auto pt-6 border-t border-gray-100 dark:border-gray-800"
    >
      <span
        class="text-sm font-medium text-on-surface-variant/70 dark:text-dark-on-surface-variant/70"
      >
        {pubDate.toLocaleDateString(lang === 'es' ? 'es-ES' : 'en-US')}
      </span>
      <span
        class="flex items-center text-primary font-bold text-sm group-hover:translate-x-1 group-focus-visible:translate-x-1 motion-reduce:transform-none transition-transform"
      >
        {t('common.read_more')}
        <span class="material-icons ml-1 text-base" aria-hidden="true"
          >arrow_forward</span
        >
      </span>
    </div>
  </div>
</a>
