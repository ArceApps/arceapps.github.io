---
// Security: Use environment variable for email to prevent hardcoding secrets in repo
const contactEmail = import.meta.env.PUBLIC_CONTACT_EMAIL || "your@email.com";
---
<form
  id="contact-form"
  action={`https://formsubmit.co/${contactEmail}`}
  method="POST"
  class="bg-surface dark:bg-dark-surface p-6 rounded-2xl border border-gray-200 dark:border-gray-800 shadow-sm"
>
  <!-- FormSubmit Configuration -->
  <input type="hidden" name="_subject" value="Nuevo mensaje de contacto - ArceApps">
  <input type="hidden" name="_template" value="table">
  <input type="hidden" name="_captcha" value="false">
  <input type="hidden" name="_next" value="https://arceapps.github.io/about-me">
  <!-- Honeypot for spam protection -->
  <input type="text" name="_honey" class="hidden">

  <div class="mb-4">
    <label for="name" class="block text-sm font-medium text-on-surface dark:text-dark-on-surface mb-1">
      Nombre <span class="text-red-500">*</span>
    </label>
    <input
      type="text"
      name="name"
      id="name"
      autocomplete="name"
      required
      class="w-full px-4 py-2 rounded-lg bg-surface-variant/30 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all text-on-surface dark:text-dark-on-surface"
      placeholder="Tu nombre"
    />
  </div>

  <div class="mb-4">
    <label for="email" class="block text-sm font-medium text-on-surface dark:text-dark-on-surface mb-1">
      Correo electrónico <span class="text-red-500">*</span>
    </label>
    <input
      type="email"
      name="email"
      id="email"
      autocomplete="email"
      required
      class="w-full px-4 py-2 rounded-lg bg-surface-variant/30 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all text-on-surface dark:text-dark-on-surface"
      placeholder="tu@email.com"
    />
  </div>

  <div class="mb-6">
    <label for="message" class="block text-sm font-medium text-on-surface dark:text-dark-on-surface mb-1">
      Mensaje <span class="text-red-500">*</span>
    </label>
    <textarea
      name="message"
      id="message"
      rows="4"
      required
      class="w-full px-4 py-2 rounded-lg bg-surface-variant/30 dark:bg-gray-800 border border-gray-300 dark:border-gray-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all text-on-surface dark:text-dark-on-surface resize-none"
      placeholder="¿En qué podemos ayudarte?"
    ></textarea>
  </div>

  <button
    type="submit"
    id="submit-btn"
    class="w-full py-3 px-6 rounded-lg bg-primary text-white font-bold shadow-md hover:shadow-lg hover:bg-primary/90 transition-all flex items-center justify-center gap-2 disabled:opacity-75 disabled:cursor-not-allowed"
  >
    <span class="material-icons" id="btn-icon" aria-hidden="true">send</span>
    <span id="btn-text">Enviar Mensaje</span>
  </button>

  <div class="mt-4 p-3 bg-primary/10 rounded-lg text-xs text-on-surface-variant dark:text-dark-on-surface-variant">
    <p class="font-bold mb-1">⚠️ Configuración requerida:</p>
    <ol class="list-decimal list-inside space-y-1">
      <li>Opción A: Crea un archivo <code>.env</code> con <code>PUBLIC_CONTACT_EMAIL=tu@email.com</code>.</li>
      <li>Opción B: Edita este archivo y cambia el fallback <code>your@email.com</code>.</li>
      <li>Envía un mensaje de prueba para activar FormSubmit.</li>
    </ol>
  </div>
</form>

<script>
  // Simple JS to handle loading state
  const form = document.getElementById('contact-form');
  const btn = document.getElementById('submit-btn') as HTMLButtonElement | null;
  const btnIcon = document.getElementById('btn-icon');
  const btnText = document.getElementById('btn-text');

  if (form && btn && btnIcon && btnText) {
    form.addEventListener('submit', () => {
      // Disable button
      btn.disabled = true;

      // Change icon to loading spinner
      btnIcon.textContent = 'autorenew';
      btnIcon.classList.add('animate-spin');

      // Change text
      btnText.textContent = 'Enviando...';
    });
  }
</script>
