---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const devlogs = await getCollection('devlog', ({ data }) => !data.draft);
  return devlogs.map((log) => ({
    params: { slug: log.slug },
    props: log,
  }));
}

const log = Astro.props;
const { Content } = await log.render();

const formattedDate = log.data.pubDate.toLocaleDateString('es-ES', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric',
});

const defaultImage = "/images/devlog-default.svg";
const heroImage = log.data.heroImage || defaultImage;
---

<Layout title={`${log.data.title} - Bitácora`} description={log.data.description} image={heroImage}>
  <article class="pt-24 pb-20">
    <!-- Header -->
    <header class="container mx-auto px-4 mb-12 max-w-4xl text-center">
      <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-primary/10 text-primary text-sm font-bold mb-6">
         <span class="material-icons text-sm" aria-hidden="true">code</span>
         Bitácora
      </div>

      <h1 class="text-3xl md:text-5xl font-bold mb-6 text-on-surface dark:text-dark-on-surface leading-tight">
        {log.data.title}
      </h1>

      <div class="flex items-center justify-center text-on-surface-variant dark:text-dark-on-surface-variant text-lg mb-8">
        <span class="material-icons mr-2 text-primary" aria-hidden="true">calendar_today</span>
        <time datetime={log.data.pubDate.toISOString()}>{formattedDate}</time>
      </div>

      <!-- Hero Image -->
      <div class="w-full aspect-video rounded-2xl overflow-hidden shadow-xl mb-8">
        <img
          src={heroImage}
          alt={`Portada de ${log.data.title}`}
          class="w-full h-full object-cover"
          loading="eager"
          width="1280"
          height="720"
        />
      </div>
    </header>

    <!-- Content -->
    <div class="container mx-auto px-4 max-w-3xl">
      <div class="prose prose-slate dark:prose-invert md:prose-lg max-w-none bg-surface dark:bg-dark-surface p-8 md:p-12 rounded-2xl shadow-sm border border-gray-100 dark:border-gray-800 prose-a:focus-visible:ring-2 prose-a:focus-visible:ring-primary prose-a:focus-visible:outline-none prose-a:rounded-sm">
        <Content />
      </div>

      <div class="mt-12 flex justify-center">
         <a href="/devlog" class="inline-flex items-center font-medium text-on-surface-variant dark:text-dark-on-surface-variant hover:text-primary transition-colors focus-visible:ring-2 focus-visible:ring-primary focus-visible:outline-none rounded px-2 py-1">
            <span class="material-icons mr-2" aria-hidden="true">arrow_back</span>
            Volver a la bitácora
         </a>
      </div>
    </div>
  </article>
</Layout>

<style is:global>
   /* Custom prose styles if needed */
   .prose blockquote {
      border-left-color: var(--color-primary);
      background-color: var(--color-surface-variant);
      color: var(--color-on-surface-variant);
      padding: 1rem;
      border-radius: 0 0.5rem 0.5rem 0;
   }
   /* Dark mode adjustment via class strategy if prose-invert isn't catching everything */
   .dark .prose blockquote {
      background-color: rgba(255, 255, 255, 0.05);
   }
</style>
