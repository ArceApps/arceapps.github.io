---
import Layout from "../../layouts/Layout.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const apps = await getCollection("apps", ({ data }) => !data.draft);
  return apps.map((app) => ({
    params: { slug: app.slug },
    props: { app },
  }));
}

const { app } = Astro.props;
const { Content } = await app.render();
---

<Layout title={`${app.data.title} - ArceApps Portfolio`}>
  <!-- Hero Section -->
  <div class="relative bg-surface dark:bg-dark-surface min-h-[60vh] flex items-center overflow-hidden">
    <!-- Background Gradient -->
    <div class="absolute inset-0 bg-gradient-to-br from-gray-50 to-gray-200 dark:from-gray-900 dark:to-black"></div>
    <div class="absolute inset-0 bg-[url('/grid-pattern.svg')] opacity-5"></div>

    <!-- Decorative Blurs -->
    <div class="absolute top-20 right-20 w-[500px] h-[500px] bg-primary/20 rounded-full blur-[100px] animate-pulse"></div>
    <div class="absolute bottom-20 left-20 w-[400px] h-[400px] bg-secondary/10 rounded-full blur-[80px]"></div>

    <div class="container mx-auto px-4 relative z-10 py-20">
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
        <!-- Text Content -->
        <div class="order-2 lg:order-1">
          <div class="flex flex-wrap gap-2 mb-6">
            {app.data.tags?.map(tag => (
              <span class="px-3 py-1 text-sm font-bold text-primary bg-primary/10 rounded-full border border-primary/20">
                {tag}
              </span>
            ))}
          </div>

          <div class="flex items-center gap-4 mb-4">
            {app.data.realIconUrl && (
              <img src={app.data.realIconUrl} alt={`${app.data.title} icon`} class="w-16 h-16 rounded-2xl shadow-md" />
            )}
            <h1 class="text-5xl md:text-6xl font-black text-on-surface dark:text-dark-on-surface leading-tight">
              {app.data.title}
            </h1>
          </div>

          <div class="flex flex-wrap items-center gap-4 mb-8 text-on-surface-variant dark:text-dark-on-surface-variant">
            {app.data.rating && (
              <div class="flex items-center gap-1 bg-surface-variant/30 dark:bg-dark-surface-variant/30 px-3 py-1 rounded-lg">
                <span class="text-lg font-bold">{app.data.rating}</span>
                <span class="material-icons text-yellow-500 text-lg" aria-hidden="true">star</span>
              </div>
            )}
            {app.data.version && (
              <div class="px-3 py-1 rounded-lg bg-surface-variant/30 dark:bg-dark-surface-variant/30">
                <span class="text-sm">v{app.data.version}</span>
              </div>
            )}
            {app.data.lastUpdated && (
              <div class="flex items-center gap-2 px-3 py-1 rounded-lg bg-surface-variant/30 dark:bg-dark-surface-variant/30">
                <span class="material-icons text-sm" aria-hidden="true">update</span>
                <span class="text-sm">Actualizado: {app.data.lastUpdated}</span>
              </div>
            )}
          </div>

          <p class="text-xl text-on-surface-variant dark:text-dark-on-surface-variant mb-10 leading-relaxed">
            {app.data.description}
          </p>

          <div class="flex flex-wrap gap-4">
            {app.data.googlePlayUrl && (
              <a
                href={app.data.googlePlayUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-3 bg-on-surface dark:bg-white text-surface dark:text-black px-8 py-4 rounded-xl font-bold text-lg hover:scale-105 transition-transform shadow-xl focus-visible:ring-4 focus-visible:ring-primary/50 focus-visible:outline-none"
              >
                <span class="material-icons" aria-hidden="true">shop</span>
                Google Play
              </a>
            )}

            {app.data.demoUrl && (
              <a
                href={app.data.demoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-3 bg-surface border-2 border-primary text-primary px-8 py-4 rounded-xl font-bold text-lg hover:bg-primary/5 transition-colors focus-visible:ring-4 focus-visible:ring-primary/50 focus-visible:outline-none"
              >
                <span class="material-icons" aria-hidden="true">visibility</span>
                Live Demo
              </a>
            )}

            {app.data.repoUrl && (
              <a
                href={app.data.repoUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="flex items-center gap-3 text-on-surface-variant dark:text-dark-on-surface-variant px-6 py-4 font-bold text-lg hover:text-primary transition-colors focus-visible:ring-2 focus-visible:ring-primary focus-visible:outline-none rounded-lg"
              >
                <span class="material-icons" aria-hidden="true">code</span>
                Código
              </a>
            )}
          </div>
        </div>

        <!-- Hero Image -->
        <div class="order-1 lg:order-2 flex justify-center perspective-1000">
          <div class="relative w-full max-w-md aspect-[4/5] rounded-3xl overflow-hidden shadow-2xl transform rotate-y-12 hover:rotate-y-0 transition-transform duration-700 bg-gray-200 dark:bg-gray-800">
            {app.data.heroImage ? (
              <img
                src={app.data.heroImage}
                alt={app.data.title}
                width="400"
                height="500"
                fetchpriority="high"
                class="w-full h-full object-cover"
              />
            ) : (
              <div class="w-full h-full flex flex-col items-center justify-center text-gray-400">
                <span class="material-icons text-8xl mb-4" aria-hidden="true">smartphone</span>
                <span class="text-xl font-medium">No Image Available</span>
              </div>
            )}
            <!-- Gloss effect -->
            <div class="absolute inset-0 bg-gradient-to-tr from-white/20 to-transparent pointer-events-none"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Content Section -->
  <article class="py-20 bg-surface-variant/20 dark:bg-dark-surface-variant/20">
    <div class="container mx-auto px-4 max-w-4xl">

      {app.data.screenshots && app.data.screenshots.length > 0 && (
        <div class="mb-12">
          <h2 class="text-2xl font-bold mb-6 text-on-surface dark:text-dark-on-surface flex items-center gap-2">
            <span class="material-icons text-primary" aria-hidden="true">collections</span>
            Galería
          </h2>
          <div
            class="flex overflow-x-auto gap-4 pb-4 snap-x snap-mandatory scrollbar-hide focus-visible:ring-2 focus-visible:ring-primary focus-visible:outline-none rounded-xl"
            tabindex="0"
            aria-label="Galería de capturas de pantalla"
          >
            {app.data.screenshots.map((screenshot, index) => (
              <img
                src={screenshot}
                alt={`Screenshot ${index + 1}`}
                class="h-64 w-auto rounded-xl shadow-md snap-center flex-shrink-0 border border-gray-200 dark:border-gray-700"
                loading="lazy"
              />
            ))}
          </div>
        </div>
      )}

      <div class="prose prose-lg dark:prose-invert prose-headings:font-bold prose-headings:text-on-surface dark:prose-headings:text-dark-on-surface prose-p:text-on-surface-variant dark:prose-p:text-dark-on-surface-variant prose-a:text-primary hover:prose-a:text-secondary max-w-none bg-surface dark:bg-dark-surface p-8 md:p-12 rounded-3xl shadow-sm border border-gray-100 dark:border-gray-800">
        <Content />
      </div>

      <!-- Navigation Footer -->
      <div class="mt-12 flex justify-between items-center">
        <a href="/apps" class="flex items-center gap-2 text-on-surface-variant dark:text-dark-on-surface-variant hover:text-primary transition-colors font-medium focus-visible:ring-2 focus-visible:ring-primary focus-visible:outline-none rounded">
          <span class="material-icons" aria-hidden="true">arrow_back</span>
          Volver al Portfolio
        </a>
      </div>
    </div>
  </article>
</Layout>

<style>
  .perspective-1000 {
    perspective: 1000px;
  }
  .rotate-y-12 {
    transform: rotateY(-12deg) rotateX(5deg);
  }
  .hover\:rotate-y-0:hover {
    transform: rotateY(0) rotateX(0);
  }
</style>
