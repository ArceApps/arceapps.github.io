---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
	const posts = await getCollection("blog");
	return posts.map((post) => ({
		params: { slug: post.slug },
		props: post,
	}));
}
const post = Astro.props;
const { Content, headings } = await post.render();

// Calculate reading time (rough estimate: 200 words per minute)
const wordCount = post.body.split(/\s+/).length;
const readingTime = Math.ceil(wordCount / 200);

// Get all posts for related posts
const allPosts = (await getCollection("blog")).sort(
	(a, b) =>
		new Date(b.data.pubDate).valueOf() - new Date(a.data.pubDate).valueOf(),
);

// Find related posts by matching tags
const relatedPosts = allPosts
	.filter((p) => p.slug !== post.slug)
	.filter((p) => p.data.tags.some((tag) => post.data.tags.includes(tag)))
	.slice(0, 3);
---

<Layout title={post.data.title}>
	<!-- Hero Section -->
	<div
		class="relative overflow-hidden bg-gradient-to-br from-slate-50 to-slate-100 dark:from-gray-900 dark:to-gray-800"
	>
		<div
			class="absolute inset-0 bg-grid-slate/[0.02] dark:bg-grid-white/[0.05] bg-[size:20px_20px]"
		>
		</div>
		<div
			class="absolute inset-0 bg-gradient-to-t from-white dark:from-dark-950 via-transparent"
		>
		</div>

		<div class="container mx-auto px-4 pt-32 pb-16 relative z-10">
			<div class="max-w-4xl mx-auto">
				<!-- Breadcrumb -->
				<nav
					class="flex items-center space-x-2 text-sm mb-8 text-gray-500 dark:text-gray-400"
				>
					<a href="/" class="hover:text-primary transition-colors"
						>Inicio</a
					>
					<span>/</span>
					<a href="/blog" class="hover:text-primary transition-colors"
						>Blog</a
					>
					<span>/</span>
					<span class="text-gray-700 dark:text-gray-300"
						>{post.data.title}</span
					>
				</nav>

				<!-- Title -->
				<h1
					class="text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 dark:text-white mb-6 font-heading leading-tight"
				>
					{post.data.title}
				</h1>

				<!-- Description -->
				<p
					class="text-xl text-gray-600 dark:text-gray-300 mb-8 leading-relaxed"
				>
					{post.data.description}
				</p>

				<!-- Metadata -->
				<div
					class="flex flex-wrap items-center gap-6 text-gray-500 dark:text-gray-400"
				>
					<div class="flex items-center gap-2">
						<svg
							class="w-5 h-5"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
							></path>
						</svg>
						<time datetime={post.data.pubDate}>
							{
								new Date(post.data.pubDate).toLocaleDateString(
									"es-ES",
									{
										year: "numeric",
										month: "long",
										day: "numeric",
									},
								)
							}
						</time>
					</div>
					<div class="flex items-center gap-2">
						<svg
							class="w-5 h-5"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"
							></path>
						</svg>
						<span>{readingTime} min lectura</span>
					</div>
				</div>

				<!-- Tags -->
				<div class="flex flex-wrap gap-2 mt-6">
					{
						post.data.tags.map((tag: string) => (
							<span class="px-3 py-1 bg-primary/20 text-primary rounded-full text-sm font-medium">
								{tag}
							</span>
						))
					}
				</div>
			</div>
		</div>
	</div>

	<!-- Main Content -->
	<div class="container mx-auto px-4 py-16">
		<div class="max-w-7xl mx-auto">
			<div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
				<!-- Table of Contents (Desktop) -->
				<aside class="hidden lg:block lg:col-span-3">
					<div class="sticky top-24">
						<h3
							class="text-sm font-bold text-gray-900 dark:text-white mb-4 uppercase tracking-wider"
						>
							En este art√≠culo
						</h3>
						<nav class="space-y-2 text-sm">
							{
								headings.map((heading: any) => (
									<a
										href={`#${heading.slug}`}
										class="block text-gray-600 dark:text-gray-400 hover:text-primary transition-colors"
										style={`padding-left: ${(heading.depth - 2) * 12}px`}
									>
										{heading.text}
									</a>
								))
							}
						</nav>

						<!-- Share Buttons -->
						<div
							class="mt-8 pt-8 border-t border-gray-200 dark:border-white/10"
						>
							<h3
								class="text-sm font-bold text-gray-900 dark:text-white mb-4 uppercase tracking-wider"
							>
								Compartir
							</h3>
							<div class="flex gap-3">
								<a
									href={`https://twitter.com/intent/tweet?text=${encodeURIComponent(post.data.title)}&url=${encodeURIComponent(Astro.url.href)}`}
									target="_blank"
									rel="noopener noreferrer"
									class="flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-dark-800 hover:bg-primary hover:text-white transition-colors"
									aria-label="Compartir en Twitter"
								>
									<svg
										class="w-5 h-5"
										fill="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"
										></path>
									</svg>
								</a>
								<a
									href={`https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}`}
									target="_blank"
									rel="noopener noreferrer"
									class="flex items-center justify-center w-10 h-10 rounded-lg bg-gray-100 dark:bg-dark-800 hover:bg-primary hover:text-white transition-colors"
									aria-label="Compartir en LinkedIn"
								>
									<svg
										class="w-5 h-5"
										fill="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"
										></path>
									</svg>
								</a>
							</div>
						</div>
					</div>
				</aside>

				<!-- Article Content -->
				<article class="lg:col-span-9">
					<div
						class="prose prose-lg dark:prose-invert prose-headings:font-heading prose-headings:font-bold prose-a:text-primary prose-a:no-underline hover:prose-a:underline prose-code:text-primary prose-code:bg-gray-100 dark:prose-code:bg-dark-800 prose-code:px-1 prose-code:py-0.5 prose-code:rounded prose-pre:bg-gray-900 dark:prose-pre:bg-dark-900 prose-pre:border prose-pre:border-gray-800 prose-img:rounded-xl prose-img:shadow-lg max-w-none"
					>
						<Content />
					</div>

					<!-- Author/Footer Section -->
					<div
						class="mt-16 pt-8 border-t border-gray-200 dark:border-white/10"
					>
						<div
							class="bg-gradient-to-br from-primary/5 to-accent/5 dark:from-primary/10 dark:to-accent/10 rounded-2xl p-8"
						>
							<div class="flex items-start gap-6">
								<div class="flex-shrink-0">
									<div
										class="w-16 h-16 rounded-full bg-gradient-to-br from-primary to-accent flex items-center justify-center text-white text-2xl font-bold"
									>
										AA
									</div>
								</div>
								<div>
									<h3
										class="text-xl font-bold text-gray-900 dark:text-white mb-2"
									>
										ArceApps Team
									</h3>
									<p
										class="text-gray-600 dark:text-gray-400 mb-4"
									>
										Desarrolladores apasionados por crear
										experiencias m√≥viles excepcionales.
										Compartimos nuestro conocimiento sobre
										Android, Kotlin y las mejores pr√°cticas
										de desarrollo.
									</p>
									<a
										href="/about"
										class="text-primary hover:underline font-medium"
									>
										Conoce m√°s sobre nosotros ‚Üí
									</a>
								</div>
							</div>
						</div>
					</div>
				</article>
			</div>
		</div>
	</div>

	<!-- Related Posts -->
	{
		relatedPosts.length > 0 && (
			<div class="bg-gray-50 dark:bg-dark-900 py-16">
				<div class="container mx-auto px-4">
					<div class="max-w-7xl mx-auto">
						<h2 class="text-3xl font-bold text-gray-900 dark:text-white mb-8 font-heading">
							Art√≠culos relacionados
						</h2>
						<div class="grid grid-cols-1 md:grid-cols-3 gap-8">
							{relatedPosts.map((relatedPost) => (
								<a
									href={`/blog/${relatedPost.slug}/`}
									class="group block bg-white dark:bg-dark-800 rounded-xl overflow-hidden border border-gray-200 dark:border-white/5 hover:border-primary/30 transition-all hover:-translate-y-1 shadow-sm"
								>
									<div class="aspect-[16/9] overflow-hidden relative">
										{relatedPost.data.heroImage ? (
											<img
												src={relatedPost.data.heroImage}
												alt={relatedPost.data.title}
												class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
											/>
										) : (
											<div class="w-full h-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-dark-700 dark:to-dark-600 flex items-center justify-center">
												<span class="text-4xl opacity-50">
													üìù
												</span>
											</div>
										)}
									</div>
									<div class="p-6">
										<h3 class="text-lg font-bold text-gray-900 dark:text-white mb-2 group-hover:text-primary transition-colors line-clamp-2">
											{relatedPost.data.title}
										</h3>
										<p class="text-gray-600 dark:text-gray-400 text-sm line-clamp-2">
											{relatedPost.data.description}
										</p>
									</div>
								</a>
							))}
						</div>
					</div>
				</div>
			</div>
		)
	}
</Layout>

<style>
	.bg-grid-white,
	.bg-grid-slate {
		background-image: linear-gradient(
				to right,
				rgba(255, 255, 255, 0.1) 1px,
				transparent 1px
			),
			linear-gradient(
				to bottom,
				rgba(255, 255, 255, 0.1) 1px,
				transparent 1px
			);
	}
</style>
