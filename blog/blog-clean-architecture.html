<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clean Architecture en Android: La Arquitectura que Revolucionar√° tu Desarrollo - ArceApps Blog</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-left">
        <div class="nav-logo">
          <h3><a href="../index.html">ArceApps</a></h3>
        </div>
      </div>
      <div class="nav-right">
        <ul class="nav-menu" id="nav-menu">
          <li class="nav-item">
            <a href="../index.html" class="nav-link">Inicio</a>
          </li>
          <li class="nav-item">
            <a href="../about.html" class="nav-link">About</a>
          </li>
          <li class="nav-item">
            <a href="../portfolio.html" class="nav-link">Portfolio</a>
          </li>
          <li class="nav-item">
            <a href="../blog.html" class="nav-link active">Blog</a>
          </li>
          <li class="nav-item">
            <a href="../privacy-policy-en.html" class="nav-link">Pol√≠tica de privacidad</a>
          </li>
        </ul>
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
          <div class="theme-toggle-circle">
            <span class="theme-icon">üåô</span>
          </div>
        </button>
        <div class="nav-toggle" id="nav-toggle">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </div>
      </div>
    </div>
  </nav>

  <article class="blog-article">
    <div class="container">
      <header class="article-header">
        <div class="article-meta">
          <span class="article-date">15 de enero de 2026</span>
          <span class="article-category">Desarrollo Android</span>
        </div>
        <h1>Clean Architecture en Android: La Arquitectura que Revolucionar√° tu Desarrollo</h1>
        <p class="article-subtitle">Descubre c√≥mo Clean Architecture transforma apps Android complejas en c√≥digo mantenible, testeable y escalable. Aprende a implementar las capas correctamente con ejemplos pr√°cticos de una app de e-commerce llamada ShopFlow.</p>
        <div class="article-image">
          <img src="../images/placeholder-article-clean-architecture.svg" alt="Clean Architecture Android" />
        </div>
      </header>

      <div class="article-content">
        <h2>üèõÔ∏è ¬øQu√© es Clean Architecture y por qu√© deber√≠a importarte?</h2>
        <p>Imagina que tienes una app de e-commerce con miles de l√≠neas de c√≥digo. Un d√≠a necesitas cambiar la base de datos de Room a Realm, otro d√≠a quieres migrar de Retrofit a OkHttp, y la semana siguiente tu jefe quiere a√±adir pagos con criptomonedas. Si tu c√≥digo est√° <strong>acoplado como espaguetis</strong> üçù, cada cambio ser√° una pesadilla que puede romper toda la aplicaci√≥n.</p>

        <p><strong>Clean Architecture</strong> es la soluci√≥n que Robert C. Martin (Uncle Bob) propuso para este problema. No es solo otro patr√≥n de moda: es una <strong>filosof√≠a de dise√±o</strong> que separa tu aplicaci√≥n en capas conc√©ntricas, donde las dependencias siempre apuntan hacia el centro (la l√≥gica de negocio).</p>

        <div class="architecture-benefits-overview">
          <h3>üéØ ¬øPor qu√© Clean Architecture es el game-changer que necesitas?</h3>
          <div class="benefits-grid">
            <div class="benefit-card">
              <div class="benefit-icon">üîß</div>
              <h4>Mantenibilidad Extrema</h4>
              <p>Cambios en UI no afectan la l√≥gica de negocio, y viceversa</p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">üß™</div>
              <h4>Testing sin Dolor</h4>
              <p>Cada capa se testea independientemente sin dependencias externas</p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">üöÄ</div>
              <h4>Escalabilidad Real</h4>
              <p>Equipos grandes pueden trabajar en paralelo sin conflictos</p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">üîÑ</div>
              <h4>Flexibilidad Total</h4>
              <p>Cambiar frameworks o bibliotecas sin reescribir la aplicaci√≥n</p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">üì±</div>
              <h4>Independencia de Framework</h4>
              <p>L√≥gica de negocio pura, sin dependencias de Android</p>
            </div>
            <div class="benefit-card">
              <div class="benefit-icon">üéØ</div>
              <h4>Reglas de Negocio Claras</h4>
              <p>L√≥gica de dominio protegida en el centro de la arquitectura</p>
            </div>
          </div>
        </div>

        <h2>üé™ Las Capas de Clean Architecture: El Circo Perfecto</h2>
        <p>Clean Architecture organiza tu app como un <strong>circo de tres pistas</strong>, donde cada capa tiene su funci√≥n espec√≠fica y las dependencias fluyen hacia el centro como en un embudo m√°gico:</p>

        <div class="article-image">
          <img src="../images/clean-architecture-android-layers.svg" alt="Capas de Clean Architecture en Android" />
        </div>

        <div class="clean-architecture-layers">
          <div class="layer-card presentation">
            <div class="layer-header">
              <h3>üì± Capa de Presentaci√≥n (UI Layer)</h3>
              <span class="layer-subtitle">La cara bonita de tu app</span>
            </div>
            <div class="layer-content">
              <h4>Responsabilidades:</h4>
              <ul>
                <li><strong>Activities y Fragments:</strong> Gesti√≥n del ciclo de vida de Android</li>
                <li><strong>Jetpack Compose:</strong> UI declarativa y reactiva</li>
                <li><strong>ViewModels:</strong> Estado de UI y comunicaci√≥n con Use Cases</li>
                <li><strong>UI Models:</strong> Datos preparados espec√≠ficamente para la UI</li>
              </ul>
              <h4>üö´ Lo que NO debe hacer:</h4>
              <ul>
                <li>Contener l√≥gica de negocio compleja</li>
                <li>Acceder directamente a fuentes de datos</li>
                <li>Formatear datos m√°s all√° de la presentaci√≥n</li>
              </ul>
            </div>
          </div>

          <div class="layer-card domain">
            <div class="layer-header">
              <h3>üß† Capa de Dominio (Business Logic)</h3>
              <span class="layer-subtitle">El coraz√≥n inteligente</span>
            </div>
            <div class="layer-content">
              <h4>Responsabilidades:</h4>
              <ul>
                <li><strong>Entities:</strong> Objetos de negocio puros con reglas</li>
                <li><strong>Use Cases:</strong> Casos de uso espec√≠ficos de la aplicaci√≥n</li>
                <li><strong>Repository Interfaces:</strong> Contratos para acceso a datos</li>
                <li><strong>Domain Services:</strong> L√≥gica de dominio compleja</li>
              </ul>
              <h4>‚úÖ Caracter√≠sticas clave:</h4>
              <ul>
                <li>Sin dependencias de Android Framework</li>
                <li>100% Kotlin puro o Java</li>
                <li>F√°cilmente testeable</li>
                <li>Reutilizable en otros proyectos</li>
              </ul>
            </div>
          </div>

          <div class="layer-card data">
            <div class="layer-header">
              <h3>üíæ Capa de Datos (Infrastructure)</h3>
              <span class="layer-subtitle">Los trabajadores incansables</span>
            </div>
            <div class="layer-content">
              <h4>Responsabilidades:</h4>
              <ul>
                <li><strong>Repository Implementations:</strong> L√≥gica real de acceso a datos</li>
                <li><strong>Data Sources:</strong> Local (Room) y Remote (Retrofit)</li>
                <li><strong>Data Models:</strong> DTOs y entidades de base de datos</li>
                <li><strong>Mappers:</strong> Conversi√≥n entre capas de datos</li>
              </ul>
              <h4>üéØ Funciones especiales:</h4>
              <ul>
                <li>Gesti√≥n de cach√© inteligente</li>
                <li>Sincronizaci√≥n offline/online</li>
                <li>Manejo de errores de red</li>
                <li>Transformaci√≥n de datos</li>
              </ul>
            </div>
          </div>
        </div>

        <h2>üõ†Ô∏è ShopFlow: Implementando Clean Architecture en una App Real</h2>
        <p>Vamos a construir <strong>ShopFlow</strong>, una app de e-commerce que permita a los usuarios navegar productos, a√±adirlos al carrito y realizar compras. Te mostrar√© c√≥mo implementar cada capa siguiendo Clean Architecture:</p>

        <h3>üéØ Capa de Dominio: El N√∫cleo del Negocio</h3>
        <p>Comenzamos por el centro: las <strong>Entities</strong> que representan nuestros conceptos de negocio puros:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">domain/model/Product.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Entity pura sin dependencias de Android
data class Product(
    val id: ProductId,
    val name: String,
    val description: String,
    val price: Money,
    val category: ProductCategory,
    val imageUrls: List<String>,
    val isAvailable: Boolean,
    val stockQuantity: Int,
    val rating: ProductRating
) {
    // üß† L√≥gica de dominio encapsulada
    fun canBePurchased(requestedQuantity: Int): Boolean {
        return isAvailable && stockQuantity >= requestedQuantity
    }
    
    fun calculateDiscountedPrice(discount: Discount): Money {
        return when (discount.type) {
            DiscountType.PERCENTAGE -> price * (1 - discount.value)
            DiscountType.FIXED_AMOUNT -> (price - discount.value).coerceAtLeast(Money.ZERO)
        }
    }
    
    fun isLowStock(): Boolean = stockQuantity < 10
}

// Value Objects para mayor expresividad
@JvmInline
value class ProductId(val value: String)

@JvmInline 
value class Money(val amount: Double) {
    companion object {
        val ZERO = Money(0.0)
    }
    
    operator fun times(factor: Double) = Money(amount * factor)
    operator fun minus(other: Money) = Money(amount - other.amount)
}

data class ProductRating(
    val average: Double,
    val totalReviews: Int
) {
    fun isHighlyRated() = average >= 4.0 && totalReviews >= 10
}</code></pre>
        </div>

        <p>Ahora definamos los <strong>Use Cases</strong> que encapsulan las reglas de negocio de nuestra app:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">domain/usecase/GetProductsUseCase.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Use Case con l√≥gica de negocio espec√≠fica
class GetProductsUseCase @Inject constructor(
    private val productRepository: ProductRepository,
    private val userPreferencesRepository: UserPreferencesRepository
) {
    suspend operator fun invoke(
        category: ProductCategory? = null,
        sortBy: ProductSortOption = ProductSortOption.RELEVANCE
    ): Result<List<Product>> {
        return try {
            val userPreferences = userPreferencesRepository.getUserPreferences()
            
            // üß† L√≥gica de negocio: filtrar por preferencias del usuario
            val products = when (category) {
                null -> productRepository.getAllProducts()
                else -> productRepository.getProductsByCategory(category)
            }
            
            // üéØ Aplicar filtros de negocio
            val filteredProducts = products
                .filter { it.isAvailable }
                .filter { product -> 
                    !userPreferences.hideOutOfStock || product.stockQuantity > 0 
                }
                .let { productList ->
                    if (userPreferences.onlyHighRated) {
                        productList.filter { it.rating.isHighlyRated() }
                    } else productList
                }
            
            // üîÑ Aplicar ordenamiento
            val sortedProducts = when (sortBy) {
                ProductSortOption.PRICE_LOW_TO_HIGH -> filteredProducts.sortedBy { it.price.amount }
                ProductSortOption.PRICE_HIGH_TO_LOW -> filteredProducts.sortedByDescending { it.price.amount }
                ProductSortOption.RATING -> filteredProducts.sortedByDescending { it.rating.average }
                ProductSortOption.NAME -> filteredProducts.sortedBy { it.name }
                ProductSortOption.RELEVANCE -> filteredProducts // Ya ordenados por relevancia
            }
            
            Result.success(sortedProducts)
            
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
}</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">domain/usecase/AddToCartUseCase.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Use Case con validaciones de negocio complejas
class AddToCartUseCase @Inject constructor(
    private val cartRepository: CartRepository,
    private val productRepository: ProductRepository,
    private val inventoryService: InventoryService
) {
    suspend operator fun invoke(
        productId: ProductId,
        quantity: Int
    ): Result<CartItem> {
        return try {
            // üîç Validaciones de negocio
            if (quantity <= 0) {
                return Result.failure(InvalidQuantityException())
            }
            
            val product = productRepository.getProductById(productId)
                ?: return Result.failure(ProductNotFoundException(productId))
            
            // üß† Verificar disponibilidad seg√∫n reglas de negocio
            if (!product.canBePurchased(quantity)) {
                return Result.failure(InsufficientStockException(product.stockQuantity))
            }
            
            // üìä Verificar l√≠mites de carrito (regla de negocio)
            val currentCart = cartRepository.getCurrentCart()
            val totalItemsAfterAdd = currentCart.totalQuantity + quantity
            
            if (totalItemsAfterAdd > MAX_CART_ITEMS) {
                return Result.failure(CartCapacityExceededException())
            }
            
            // üí∞ Calcular precio con descuentos aplicables
            val applicableDiscount = inventoryService.getApplicableDiscount(product)
            val finalPrice = applicableDiscount?.let { 
                product.calculateDiscountedPrice(it) 
            } ?: product.price
            
            // ‚úÖ Crear item de carrito
            val cartItem = CartItem(
                product = product,
                quantity = quantity,
                unitPrice = finalPrice,
                discount = applicableDiscount
            )
            
            val updatedCart = cartRepository.addItem(cartItem)
            
            Result.success(cartItem)
            
        } catch (e: Exception) {
            Result.failure(e)
        }
    }
    
    companion object {
        private const val MAX_CART_ITEMS = 99
    }
}</code></pre>
        </div>

        <h3>üíæ Capa de Datos: Implementando los Repositorios</h3>
        <p>La capa de datos implementa las interfaces definidas en el dominio y gestiona todas las fuentes de datos:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">data/repository/ProductRepositoryImpl.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Implementaci√≥n del repositorio con m√∫ltiples fuentes de datos
@Singleton
class ProductRepositoryImpl @Inject constructor(
    private val remoteDataSource: ProductRemoteDataSource,
    private val localDataSource: ProductLocalDataSource,
    private val networkMonitor: NetworkMonitor,
    private val productMapper: ProductMapper
) : ProductRepository {

    override suspend fun getAllProducts(): List<Product> {
        return withContext(Dispatchers.IO) {
            try {
                // üåê Estrategia: Intentar remoto primero, fallback a local
                if (networkMonitor.isConnected()) {
                    val remoteProducts = remoteDataSource.getProducts()
                    
                    // üíæ Cachear datos localmente
                    localDataSource.saveProducts(remoteProducts)
                    
                    // üîÑ Mapear de DTOs a entidades de dominio
                    remoteProducts.map { productMapper.mapToDomain(it) }
                } else {
                    // üì± Modo offline: usar datos locales
                    val cachedProducts = localDataSource.getCachedProducts()
                    cachedProducts.map { productMapper.mapToDomain(it) }
                }
            } catch (e: Exception) {
                // üîÑ Fallback a cach√© en caso de error
                val cachedProducts = localDataSource.getCachedProducts()
                cachedProducts.map { productMapper.mapToDomain(it) }
            }
        }
    }

    override suspend fun getProductsByCategory(category: ProductCategory): List<Product> {
        return withContext(Dispatchers.IO) {
            try {
                if (networkMonitor.isConnected()) {
                    val remoteProducts = remoteDataSource.getProductsByCategory(category.name)
                    localDataSource.saveProducts(remoteProducts)
                    remoteProducts.map { productMapper.mapToDomain(it) }
                } else {
                    val cachedProducts = localDataSource.getProductsByCategory(category.name)
                    cachedProducts.map { productMapper.mapToDomain(it) }
                }
            } catch (e: Exception) {
                val cachedProducts = localDataSource.getProductsByCategory(category.name)
                cachedProducts.map { productMapper.mapToDomain(it) }
            }
        }
    }

    override suspend fun getProductById(productId: ProductId): Product? {
        return withContext(Dispatchers.IO) {
            try {
                // üîç Buscar primero en cach√© local para respuesta r√°pida
                val cachedProduct = localDataSource.getProductById(productId.value)
                if (cachedProduct != null && !cachedProduct.isStale()) {
                    return@withContext productMapper.mapToDomain(cachedProduct)
                }
                
                // üåê Si no hay cach√© o est√° obsoleto, buscar remotamente
                if (networkMonitor.isConnected()) {
                    val remoteProduct = remoteDataSource.getProductById(productId.value)
                    remoteProduct?.let {
                        localDataSource.saveProduct(it)
                        productMapper.mapToDomain(it)
                    }
                } else {
                    // üì± Modo offline: devolver cach√© aunque est√© obsoleto
                    cachedProduct?.let { productMapper.mapToDomain(it) }
                }
            } catch (e: Exception) {
                // üîÑ Siempre intentar cach√© como √∫ltimo recurso
                localDataSource.getProductById(productId.value)?.let {
                    productMapper.mapToDomain(it)
                }
            }
        }
    }
}</code></pre>
        </div>

        <h3>üì± Capa de Presentaci√≥n: ViewModels Clean</h3>
        <p>Los ViewModels act√∫an como el puente entre la UI y los Use Cases, manteniendo el estado y orquestando las operaciones:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">presentation/products/ProductListViewModel.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ ViewModel clean que solo orquesta Use Cases
@HiltViewModel
class ProductListViewModel @Inject constructor(
    private val getProductsUseCase: GetProductsUseCase,
    private val addToCartUseCase: AddToCartUseCase,
    private val searchProductsUseCase: SearchProductsUseCase
) : ViewModel() {

    private val _uiState = MutableStateFlow(ProductListUiState())
    val uiState: StateFlow<ProductListUiState> = _uiState.asStateFlow()

    private val _uiEvents = Channel<ProductListUiEvent>()
    val uiEvents: Flow<ProductListUiEvent> = _uiEvents.receiveAsFlow()

    fun loadProducts(category: ProductCategory? = null) {
        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true, error = null) }
            
            getProductsUseCase(
                category = category,
                sortBy = _uiState.value.sortOption
            ).fold(
                onSuccess = { products ->
                    _uiState.update { currentState ->
                        currentState.copy(
                            products = products.map { it.toUiModel() },
                            isLoading = false,
                            error = null
                        )
                    }
                },
                onFailure = { error ->
                    _uiState.update { currentState ->
                        currentState.copy(
                            isLoading = false,
                            error = error.toUiError()
                        )
                    }
                }
            )
        }
    }

    fun addToCart(productId: String, quantity: Int = 1) {
        viewModelScope.launch {
            addToCartUseCase(
                productId = ProductId(productId),
                quantity = quantity
            ).fold(
                onSuccess = { cartItem ->
                    _uiEvents.send(
                        ProductListUiEvent.ProductAddedToCart(
                            productName = cartItem.product.name,
                            quantity = cartItem.quantity
                        )
                    )
                },
                onFailure = { error ->
                    _uiEvents.send(
                        ProductListUiEvent.ShowError(error.toUiError())
                    )
                }
            )
        }
    }

    fun searchProducts(query: String) {
        if (query.isBlank()) {
            loadProducts(_uiState.value.selectedCategory)
            return
        }

        viewModelScope.launch {
            _uiState.update { it.copy(isLoading = true) }
            
            searchProductsUseCase(query).fold(
                onSuccess = { products ->
                    _uiState.update { currentState ->
                        currentState.copy(
                            products = products.map { it.toUiModel() },
                            isLoading = false,
                            searchQuery = query
                        )
                    }
                },
                onFailure = { error ->
                    _uiState.update { currentState ->
                        currentState.copy(
                            isLoading = false,
                            error = error.toUiError()
                        )
                    }
                }
            )
        }
    }

    fun changeSortOption(sortOption: ProductSortOption) {
        viewModelScope.launch {
            _uiState.update { it.copy(sortOption = sortOption) }
            loadProducts(_uiState.value.selectedCategory)
        }
    }
}</code></pre>
        </div>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">presentation/products/ProductListUiState.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Estado de UI inmutable y expresivo
data class ProductListUiState(
    val products: List<ProductUiModel> = emptyList(),
    val isLoading: Boolean = false,
    val error: UiError? = null,
    val selectedCategory: ProductCategory? = null,
    val sortOption: ProductSortOption = ProductSortOption.RELEVANCE,
    val searchQuery: String = ""
) {
    val hasProducts: Boolean get() = products.isNotEmpty()
    val showEmptyState: Boolean get() = !isLoading && products.isEmpty() && error == null
    val showErrorState: Boolean get() = error != null
}

// ‚úÖ Modelo de UI espec√≠fico para la presentaci√≥n
data class ProductUiModel(
    val id: String,
    val name: String,
    val description: String,
    val formattedPrice: String,
    val originalPrice: String?,
    val discountPercentage: String?,
    val category: String,
    val imageUrl: String,
    val isAvailable: Boolean,
    val stockStatus: StockStatus,
    val ratingText: String,
    val isHighlyRated: Boolean
) {
    enum class StockStatus {
        IN_STOCK,
        LOW_STOCK,
        OUT_OF_STOCK
    }
}

// ‚úÖ Eventos de UI para comunicaci√≥n unidireccional
sealed class ProductListUiEvent {
    data class ProductAddedToCart(
        val productName: String,
        val quantity: Int
    ) : ProductListUiEvent()
    
    data class ShowError(val error: UiError) : ProductListUiEvent()
    
    object NavigateToCart : ProductListUiEvent()
}</code></pre>
        </div>

        <h2>üîß Inyecci√≥n de Dependencias con Hilt</h2>
        <p>Para conectar todas las capas, configuramos Hilt para gestionar las dependencias autom√°ticamente:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">di/RepositoryModule.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Configuraci√≥n de dependencias para Clean Architecture
@Module
@InstallIn(SingletonComponent::class)
abstract class RepositoryModule {

    @Binds
    abstract fun bindProductRepository(
        productRepositoryImpl: ProductRepositoryImpl
    ): ProductRepository

    @Binds
    abstract fun bindCartRepository(
        cartRepositoryImpl: CartRepositoryImpl
    ): CartRepository

    @Binds
    abstract fun bindUserPreferencesRepository(
        userPreferencesRepositoryImpl: UserPreferencesRepositoryImpl
    ): UserPreferencesRepository
}

@Module
@InstallIn(SingletonComponent::class)
object DataModule {

    @Provides
    @Singleton
    fun provideProductDatabase(@ApplicationContext context: Context): ProductDatabase {
        return Room.databaseBuilder(
            context,
            ProductDatabase::class.java,
            "shopflow_database"
        )
        .addMigrations(*ProductDatabase.MIGRATIONS)
        .build()
    }

    @Provides
    fun provideProductDao(database: ProductDatabase): ProductDao = database.productDao()

    @Provides
    @Singleton
    fun provideRetrofit(): Retrofit {
        return Retrofit.Builder()
            .baseUrl(BuildConfig.API_BASE_URL)
            .addConverterFactory(GsonConverterFactory.create())
            .addCallAdapterFactory(ResultCallAdapterFactory())
            .client(
                OkHttpClient.Builder()
                    .addInterceptor(AuthInterceptor())
                    .addInterceptor(HttpLoggingInterceptor().apply {
                        level = if (BuildConfig.DEBUG) {
                            HttpLoggingInterceptor.Level.BODY
                        } else {
                            HttpLoggingInterceptor.Level.NONE
                        }
                    })
                    .build()
            )
            .build()
    }

    @Provides
    fun provideProductApiService(retrofit: Retrofit): ProductApiService {
        return retrofit.create(ProductApiService::class.java)
    }
}</code></pre>
        </div>

        <h2>üß™ Testing: La Ventaja Definitiva de Clean Architecture</h2>
        <p>Una de las mayores ventajas de Clean Architecture es lo <strong>incre√≠blemente f√°cil</strong> que es testear cada capa independientemente:</p>

        <div class="code-block">
          <div class="code-header">
            <span class="code-title">test/domain/usecase/GetProductsUseCaseTest.kt</span>
            <button class="copy-btn" onclick="copyCode(this)">üìã Copiar</button>
          </div>
          <pre><code class="language-kotlin">// ‚úÖ Test unitario puro sin dependencias de Android
@ExtendWith(MockitoExtension::class)
class GetProductsUseCaseTest {

    @Mock
    private lateinit var productRepository: ProductRepository
    
    @Mock
    private lateinit var userPreferencesRepository: UserPreferencesRepository

    private lateinit var getProductsUseCase: GetProductsUseCase

    @BeforeEach
    fun setup() {
        getProductsUseCase = GetProductsUseCase(productRepository, userPreferencesRepository)
    }

    @Test
    fun `when user prefers high rated products, should filter accordingly`() = runTest {
        // Given
        val userPreferences = UserPreferences(onlyHighRated = true, hideOutOfStock = false)
        val products = listOf(
            createProduct(rating = ProductRating(4.5, 100)), // Alta calificaci√≥n
            createProduct(rating = ProductRating(3.0, 50)),  // Baja calificaci√≥n
            createProduct(rating = ProductRating(4.2, 15))   // Alta calificaci√≥n
        )
        
        whenever(userPreferencesRepository.getUserPreferences())
            .thenReturn(userPreferences)
        whenever(productRepository.getAllProducts())
            .thenReturn(products)

        // When
        val result = getProductsUseCase()

        // Then
        result.onSuccess { filteredProducts ->
            assertThat(filteredProducts).hasSize(2)
            assertThat(filteredProducts.all { it.rating.isHighlyRated() }).isTrue()
        }
    }

    @Test
    fun `when repository throws exception, should return failure`() = runTest {
        // Given
        whenever(userPreferencesRepository.getUserPreferences())
            .thenReturn(UserPreferences())
        whenever(productRepository.getAllProducts())
            .thenThrow(NetworkException("Connection failed"))

        // When
        val result = getProductsUseCase()

        // Then
        assertThat(result.isFailure).isTrue()
        assertThat(result.exceptionOrNull()).isInstanceOf(NetworkException::class.java)
    }

    private fun createProduct(
        id: String = "test-id",
        rating: ProductRating = ProductRating(4.0, 10),
        isAvailable: Boolean = true,
        stockQuantity: Int = 50
    ): Product {
        return Product(
            id = ProductId(id),
            name = "Test Product",
            description = "Test Description", 
            price = Money(99.99),
            category = ProductCategory.ELECTRONICS,
            imageUrls = listOf("https://example.com/image.jpg"),
            isAvailable = isAvailable,
            stockQuantity = stockQuantity,
            rating = rating
        )
    }
}</code></pre>
        </div>

        <h2>‚ö° Clean Architecture vs MVVM: ¬øEnemigos o Mejores Amigos?</h2>
        <p>Muchos desarrolladores piensan que Clean Architecture y MVVM son <strong>competencia</strong>, pero la realidad es que son <strong>complementarios perfectos</strong>:</p>

        <div class="comparison-table">
          <div class="comparison-header">
            <h3>ü§ù MVVM + Clean Architecture = Power Couple</h3>
          </div>
          <div class="comparison-grid">
            <div class="comparison-item">
              <h4>üéØ MVVM maneja...</h4>
              <ul>
                <li>Presentaci√≥n y estado de UI</li>
                <li>Binding entre View y ViewModel</li>
                <li>Lifecycle awareness</li>
                <li>Navegaci√≥n</li>
              </ul>
            </div>
            <div class="comparison-item">
              <h4>üèõÔ∏è Clean Architecture organiza...</h4>
              <ul>
                <li>Separaci√≥n en capas</li>
                <li>Flujo de dependencias</li>
                <li>Abstracci√≥n de datos</li>
                <li>L√≥gica de negocio pura</li>
              </ul>
            </div>
          </div>
        </div>

        <h2>üö® Errores Comunes y C√≥mo Evitarlos</h2>
        
        <div class="common-mistakes">
          <div class="mistake-card">
            <h3>‚ùå Error #1: Violating the Dependency Rule</h3>
            <div class="code-block">
              <pre><code>// ‚ùå MAL: Use Case dependiendo de implementaci√≥n espec√≠fica
class GetProductsUseCase(
    private val retrofitApi: ProductApiService // ¬°Framework dependency!
) {
    // Esto rompe Clean Architecture
}</code></pre>
            </div>
            <div class="code-block">
              <pre><code>// ‚úÖ BIEN: Use Case dependiendo de abstracci√≥n
class GetProductsUseCase(
    private val productRepository: ProductRepository // Abstracci√≥n del dominio
) {
    // Esto respeta Clean Architecture
}</code></pre>
            </div>
          </div>

          <div class="mistake-card">
            <h3>‚ùå Error #2: Entities con L√≥gica de UI</h3>
            <div class="code-block">
              <pre><code>// ‚ùå MAL: Entity con dependencias de Android
data class Product(
    val name: String,
    val price: Double
) {
    fun getFormattedPrice(context: Context): String { // ¬°Android dependency!
        return context.getString(R.string.price_format, price)
    }
}</code></pre>
            </div>
            <div class="code-block">
              <pre><code>// ‚úÖ BIEN: Entity pura, formateo en capa de presentaci√≥n
data class Product(
    val name: String,
    val price: Money
) {
    // Sin dependencias de framework
}

// Formateo en capa de presentaci√≥n
fun Product.toUiModel(): ProductUiModel {
    return ProductUiModel(
        formattedPrice = "${price.amount}‚Ç¨"
    )
}</code></pre>
            </div>
          </div>

          <div class="mistake-card">
            <h3>‚ùå Error #3: Over-Engineering Inicial</h3>
            <p><strong>üéØ Consejo:</strong> No implementes Clean Architecture completa desde el d√≠a 1 en un proyecto peque√±o. Empieza con MVVM simple y refactoriza hacia Clean Architecture cuando el proyecto crezca en complejidad.</p>
          </div>
        </div>

        <h2>üéØ Mejores Pr√°cticas para el √âxito</h2>

        <div class="best-practices-section">
          <div class="practice-card">
            <h3>üèóÔ∏è Arquitectura Gradual</h3>
            <ul>
              <li><strong>Empieza simple:</strong> MVVM b√°sico para MVPs</li>
              <li><strong>A√±ade capas:</strong> Repository pattern cuando necesites m√∫ltiples fuentes de datos</li>
              <li><strong>Escala a Clean:</strong> Use Cases cuando la l√≥gica de negocio se complique</li>
              <li><strong>Refactoriza constantemente:</strong> Mejora la arquitectura seg√∫n crece el proyecto</li>
            </ul>
          </div>

          <div class="practice-card">
            <h3>üß™ Testing Strategy</h3>
            <ul>
              <li><strong>Unit tests:</strong> Dominio y Use Cases (95% coverage)</li>
              <li><strong>Integration tests:</strong> Repository implementations</li>
              <li><strong>UI tests:</strong> Flujos cr√≠ticos de usuario</li>
              <li><strong>Contract tests:</strong> APIs y interfaces</li>
            </ul>
          </div>

          <div class="practice-card">
            <h3>üì¶ Organizaci√≥n de Packages</h3>
            <div class="code-block">
              <pre><code>com.shopflow
‚îú‚îÄ‚îÄ üìÅ domain/
‚îÇ   ‚îú‚îÄ‚îÄ model/          # Entities
‚îÇ   ‚îú‚îÄ‚îÄ repository/     # Repository interfaces  
‚îÇ   ‚îî‚îÄ‚îÄ usecase/        # Use Cases
‚îú‚îÄ‚îÄ üìÅ data/
‚îÇ   ‚îú‚îÄ‚îÄ local/          # Room, SharedPrefs
‚îÇ   ‚îú‚îÄ‚îÄ remote/         # Retrofit, APIs
‚îÇ   ‚îú‚îÄ‚îÄ repository/     # Repository implementations
‚îÇ   ‚îî‚îÄ‚îÄ mapper/         # Data mappers
‚îî‚îÄ‚îÄ üìÅ presentation/
    ‚îú‚îÄ‚îÄ ui/             # Compose screens
    ‚îú‚îÄ‚îÄ viewmodel/      # ViewModels
    ‚îî‚îÄ‚îÄ model/          # UI models</code></pre>
            </div>
          </div>
        </div>

        <h2>üöÄ Pr√≥ximos Pasos: Tu Hoja de Ruta</h2>
        
        <div class="roadmap-section">
          <h3>üìö Para seguir dominando Clean Architecture</h3>
          <ol class="roadmap-list">
            <li><strong>Practica con un proyecto real:</strong> Refactoriza una app existente aplicando Clean Architecture gradualmente</li>
            <li><strong>Domina la inyecci√≥n de dependencias:</strong> Aprende Hilt a fondo para gestionar las dependencias entre capas</li>
            <li><strong>Implementa testing completo:</strong> Crea una suite de tests que cubra todas las capas</li>
            <li><strong>Explora arquitecturas avanzadas:</strong> Investiga MVI (Model-View-Intent) como evoluci√≥n natural</li>
            <li><strong>Estudia casos reales:</strong> Analiza apps open source que implementen Clean Architecture correctamente</li>
            <li><strong>Integra CI/CD:</strong> Automatiza tests y builds para mantener la calidad arquitectural</li>
          </ol>
        </div>

        <div class="conclusion-box">
          <h3>üéØ Conclusi√≥n: El Futuro de tu Desarrollo Android</h3>
          <p>Clean Architecture no es solo un patr√≥n de dise√±o, es una <strong>filosof√≠a de desarrollo</strong> que transformar√° tu manera de construir aplicaciones Android. Puede parecer complejo al principio, pero una vez que internalizas los principios, desarrollar√°s apps m√°s <strong>robustas, escalables y mantenibles</strong>.</p>
          
          <p>Recuerda: <strong>no hay soluciones m√°gicas</strong>, pero Clean Architecture te da las herramientas para construir software que perdure en el tiempo y sea un placer mantener. ¬°Empieza peque√±o, aprende constantemente, y construye hacia arriba! üöÄ</p>
        </div>

        <div class="article-footer">
          <div class="tags">
            <span class="tag">Android</span>
            <span class="tag">Kotlin</span>
            <span class="tag">Clean Architecture</span>
            <span class="tag">MVVM</span>
            <span class="tag">Use Cases</span>
            <span class="tag">Repository Pattern</span>
            <span class="tag">Domain Layer</span>
            <span class="tag">Testing</span>
            <span class="tag">Hilt</span>
            <span class="tag">Architecture</span>
          </div>
          
          <div class="article-navigation">
            <a href="blog-solid-principles.html" class="nav-button">‚Üê SOLID Principles</a>
            <a href="blog-mvvm-architecture.html" class="nav-button">Siguiente: MVVM Architecture ‚Üí</a>
          </div>
          
          <div class="share-section">
            <h4>¬øTe gust√≥ este art√≠culo?</h4>
            <p>Comp√°rtelo con otros desarrolladores Android</p>
            <div class="share-buttons">
              <button class="share-btn twitter">üê¶ Twitter</button>
              <button class="share-btn linkedin">üíº LinkedIn</button>
              <button class="share-btn whatsapp">üí¨ WhatsApp</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </article>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h3>ArceApps</h3>
          <p>Desarrollando el futuro de las aplicaciones m√≥viles con c√≥digo limpio y arquitecturas s√≥lidas.</p>
        </div>
        <div class="footer-section">
          <h4>Enlaces R√°pidos</h4>
          <ul>
            <li><a href="../index.html">Inicio</a></li>
            <li><a href="../about.html">About</a></li>
            <li><a href="../portfolio.html">Portfolio</a></li>
            <li><a href="../blog.html">Blog</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4>Categor√≠as</h4>
          <ul>
            <li><a href="../blog.html#android">Desarrollo Android</a></li>
            <li><a href="../blog.html#devops">DevOps Mobile</a></li>
            <li><a href="../blog.html#architecture">Arquitectura</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 ArceApps. Todos los derechos reservados.</p>
      </div>
    </div>
  </footer>

  <script src="../script.js"></script>
</body>
</html>